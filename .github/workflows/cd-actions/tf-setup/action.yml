name: 'Terraform Shared Setup'
description: 'Authenticates with GCP and sets up Terraform'

# Inputs create a bridge to pass repository variables into this action
inputs:
  wif_provider:
    description: 'The Workload Identity Provider string'
    required: true
  service_account:
    description: 'The GCP Service Account email'
    required: true

runs:
  using: "composite"
  steps:
    # Fixes the "Unreadable module directory" error by providing the symlink target
    - name: Checkout Common Repo
      uses: actions/checkout@v4
      with:
        repository: raghuporumamila/hello-platform-terraform
        path: terraform/hello-platform-terraform

    - name: Google Auth
      uses: 'google-github-actions/auth@v2'
      with:
        workload_identity_provider: ${{ inputs.wif_provider }}
        service_account: ${{ inputs.service_account }}

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v3